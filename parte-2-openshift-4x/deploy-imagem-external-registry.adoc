[[deploy-imagem-do-docker-hub]]
= Deploy imagem do Docker Hub
:imagesdir: images
:toc:
:toc-title: Conteúdo

== Introdução

Vamos agora implantar uma imagem existente no http://quay.io[Quay]. O Quay é um registry externo semelhante ao https://hub.docker.com/[Docker Hub].

A imagem que vamos utilizar, foi criada usando Java e o framework https://quarkus.io/[Quarkus]. Ela é extremamente pequena e roda consumindo poucos recursos.

Para executar a imagem no Openshift, siga os passos abaixo:

[[escolha-a-imagem]]
== Usando uma imagem do Quarkus

[[deploy-web-console]]
=== Deploy pela Web Console

Utilizaremos a imagem do exemplo abaixo:

[source,text,role=copypaste]
----
quay.io/gluszczy/workshop-openshift
----

Para criar um container com base em uma image externa ao Openshift, selecione a opção de `Container Image` conforme imagem abaixo:

image:deploy-image-01.png[]

Depois preencha o campo `Image name from external registry` com o valor da sua imagem, no nosso caso o valor é `quay.io/gluszczy/workshop-openshift`. Logo em seguida, tire o foco (cursor) do campo da imagem e ele irá validar se o dado informado está correto.

image::2-9-2020-15-26-41-PM.png[]

Agora deixe todos os campos com os valores padrão e clique em `Create` no fim da tela.

// O gif abaixo resume o passo que deve ser feito.

// image:deploy-image.gif[]

[[deploy-cli]]
=== Deploy pela CLI

NOTE: Só execute o comando abaixo caso não tenha feito o <<deploy-web-console,deploy pela web console>> no passo anterior.

Caso queira usar a linha de comando, execute:

[source,bash,role=copypaste]
----
oc new-app --docker-image=quay.io/gluszczy/workshop-openshift
----

=== Limpeza do ambiente

Caso você tenha errado na criação da sua aplicação nos passos anteriores, para deletá-la execute o seguinte comando no terminal:

[source,bash,role=copypaste]
----
oc delete all -l app=workshop-openshift
----

NOTE: Só delete a aplicação caso tenha acontecido algum problema na criação da sua aplicação

Se você deletou sua aplicação, pode criá-la  novamente <<deploy-cli,usando o CLI>> ou a <<deploy-web-console,Web Console>> conforme já mostrado nos passos anteriores

[[explorando-a-gui-do-pod]]
== Explorando a Web Console

=== App Resources

Para ver a nossa aplicação recém-criada, clique no menu lateral esquerdo em `Topology`.

image:topology.png[]

Você verá sua aplicação no centro da tela.

image:app-overview.png[]

1. Por meio dessa parte você tem acesso aos dados do `Pod`
2. Caso o Openshift faça o `Build` da sua imagem, seria exibido nessa parte.
3. O `Service` faz o balanceamento interno entre os containers e também serve como uma camada de `service discovery`
4. Um objeto `Route` permite acesso externo a sua aplicação

=== App Overview

Na tela de overview você tem uma visão geral da sua aplicação. Nela você pode ver quantos pods estão rodando, qual a versão atual, qual projeto e labels utilizados e também outros detalhes de deployment dessa aplicação

image:app-overview2.png[]

== Imagem e Segurança

NOTE: Os detalhes abaixo não devem ser executados. Servem só para ilustrar como o Openshift lida com imagem que rodem como `root`.

Se a imagem escolhida rodar como root, o Openshift te avisa na Web Console (por meio de uma tarja laranja) que ela pode eventualmente não executar conforme o esperado.

image:image-root.png[]

[[mais-informações]]
== Mais informações

* https://blog.openshift.com/deploying-images-from-dockerhub/
* https://blog.openshift.com/getting-any-docker-image-running-in-your-own-openshift-cluster/
* https://blog.openshift.com/deploying-images-from-dockerhub/
